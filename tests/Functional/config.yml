parameters:
    kernel.secret: secret
    log_file: %kernel.logs_dir%/test.log

services:
    # needed to make JMSSerializerBundle work
    translator:
        class: stdClass

    # needed to make JMSSerializerBundle work
    annotation_reader:
        class: Doctrine\Common\Annotations\AnnotationReader

    logger:
        class: SimpleBus\RabbitMQBundle\Tests\Functional\FileLogger
        arguments:
            - %log_file%

    asynchronous_command_handler:
        class: SimpleBus\RabbitMQBundle\Tests\Functional\LoggingCommandHandler
        arguments:
            - @logger
        tags:
            - { name: asynchronous_command_handler, handles: SimpleBus\RabbitMQBundle\Tests\Functional\AsynchronousCommand }

    asynchronous_event_subscriber:
        class: SimpleBus\RabbitMQBundle\Tests\Functional\LoggingEventSubscriber
        arguments:
            - @logger
        tags:
            - { name: asynchronous_event_subscriber, subscribes_to: SimpleBus\RabbitMQBundle\Tests\Functional\Event }

old_sound_rabbit_mq:
    connections:
        default:
            host:     'localhost'
            port:     5672
            user:     'guest'
            password: 'guest'
            vhost:    '/'
            lazy:     true
    producers:
        asynchronous_events:
            connection:       default
            exchange_options: { name: 'asynchronous_events', type: direct }
        asynchronous_commands:
            connection:       default
            exchange_options: { name: 'asynchronous_commands', type: direct }
    consumers:
        asynchronous_events:
            connection:       default
            exchange_options: { name: 'asynchronous_events', type: direct }
            queue_options:    { name: 'asynchronous_events' }
            callback:         simple_bus.rabbit_mq.events_consumer
        asynchronous_commands:
            connection:       default
            exchange_options: { name: 'asynchronous_commands', type: direct }
            queue_options:    { name: 'asynchronous_commands' }
            callback:         simple_bus.rabbit_mq.commands_consumer

simple_bus_rabbit_mq:
    commands:
        producer_service_id: old_sound_rabbit_mq.asynchronous_commands_producer
    events:
        producer_service_id: old_sound_rabbit_mq.asynchronous_events_producer
